[{"content":"Why lavalink is usually used for discord bot to play music to discord.\nIf your bot is on alot of servers and alot of people, you need tunnelbroker to prevent youtube rate limiting your ip.\n First and formost, we need to install lavalink. if you dont know how to you can check out the lavalink setup guide\nGetting TunnelBroker  Make a tunnelbroker Account Create a new regular tunnel Enter your IPv4 address and select a nearby region.   You can use https://github.com/DarrenOfficial/scripts-util/blob/main/general/he_ping.sh to find nearest / lowest ping tunnelbroker server.\n  Request a new /48 by clicking the \u0026ldquo;Assign /48\u0026rdquo; button. We can use /64, but is much more likely to be blocked.   Tunnel broker interface \nConfiguring TunnelBroker The first thing to do is enable IPv6 Binding in Linux. This enables Lavalink (and other programs) to bind to local addresses that would otherwise be considered illegal:\nSome distro doesn\u0026rsquo;t keep the value of net.ipv6.ip_nonlocal_bind after reboot, so you may need to run that command after reboot to prevent issues.\n# Enable now sysctl -w net.ipv6.ip_nonlocal_bind=1 # Persist for next boot echo \u0026#39;net.ipv6.ip_nonlocal_bind = 1\u0026#39; \u0026gt;\u0026gt; /etc/sysctl.conf Next you\u0026rsquo;ll need to configure network interfaces. edit a file on /etc/network/interfaces and add the following:\nif /etc/network/interfaces is not found, than maybe you\u0026rsquo;re using netplan. darrennathanael.com/post/tunnelbroker-lavalink-netplan\nauto he-ipv6 iface he-ipv6 inet6 v4tunnel address ::2 netmask 48 endpoint  local  ttl 255 gateway ::1 post-up /sbin/ip -6 route replace local ::/48 dev lo You will now need to add your IPv6 subnet details, you\u0026rsquo;ll need to go to tunnelbroker and copy the Server IPv4 address, Client IPv4 address, and Routed IPv6 address.\nThen you can add the following to your /etc/network/interfaces file, these should be arrange as shown in the template above.\n Your remote will be your \u0026lsquo;Server IPv4 address\u0026rsquo; Your local will be your \u0026lsquo;Client IPv4 address\u0026rsquo; Your gateway6 will be your \u0026lsquo;Routed IPv6 address\u0026rsquo; Your addresses will be your \u0026lsquo;Routed IPv6 address\u0026rsquo; Remember, you do not need to include any speech marks or apostrophes, we have simply listed them to clearly display what should only be listed. Please look at the sample configuration below, this should look similar but not the same as   \nafter doing all of that you can run ifup he-ipv6 to apply the changes.\nIf the command fail, reboot the system.\nTest your configuration Before setting up the lavalink, we need to test it to make sure it actually works.\n# Test that IPv6 works in the first place ping6 google.com # Test your tunnel with ping6 -I he-ipv6 google.com # If you have the IPv6 block 1234:1234:1234::/48 # You should be able to use any of the IPs within that block ping6 -I 1234:1234:1234:: google.com ping6 -I 1234:1234:1234::1 google.com ping6 -I 1234:1234:1234:dead::beef google.com # Make sure your /48 block appears when running this command ip -6 route ## it should look something like this #::1 dev lo proto kernel metric 256 pref medium #2001:470:cc7b::/48 dev he-ipv6 proto kernel metric 256 pref medium #fdba:17c8:6c94::/64 dev pterodactyl0 proto kernel metric 256 pref medium #fe80::/64 dev eth0 proto kernel metric 256 pref medium #fe80::/64 dev pterodactyl0 proto kernel metric 256 pref medium #fe80::/64 dev vethff50ad0 proto kernel metric 256 pref medium #fe80::/64 dev veth5832748 proto kernel metric 256 pref medium #default via 2001:470:cc7b::1 dev he-ipv6 proto static metric 1024 pref medium  \nIf theres an error such as \u0026ldquo;ping: bind icmp socket: Cannot assign requested address\u0026rdquo; then you need to make sure your configuration file is correct and run\nsysctl -w net.ipv6.ip_nonlocal_bind=1  \nHow to configure lavalink for loadbalancing Add the ratelimit block to your config:\nlavalink: server: # ... ratelimit: ipBlocks: [\u0026#34;1234:1234:1234::/48\u0026#34;] # list of ip blocks #excludedIps: [\u0026#34;...\u0026#34;, \u0026#34;...\u0026#34;] # ips which should be explicit excluded from usage by lavalink strategy: \u0026#34;RotateOnBan\u0026#34; # RotateOnBan | LoadBalance | NanoSwitch | RotatingNanoSwitch searchTriggersFail: true # Whether a search 429 should trigger marking the ip as failing retryLimit: -1 # -1 = use default lavaplayer value | 0 = infinity | \u0026gt;0 = retry will happen this numbers times  \nYou can read more about the different strategies in ROUTEPLANNERS.md\n‚ÄúHelp, I\u0026rsquo;ve tried the steps above but It doesn\u0026rsquo;t work.‚Äù If you\u0026rsquo;ve followed this entire guide and It doesn\u0026rsquo;t work, then please contact me on my discord server discord.darrennathanael.com and I\u0026rsquo;ll help you out. and also provide the following information:\n Which distro you are on The network config you wrote based on one of the Tunnelbroker examples A screenshot of the Tunnelbroker website with your tunnel details Your Netplan config The output of ip -6 route Don\u0026rsquo;t say ‚Äúdoesn\u0026rsquo;t work‚Äù. Describe your problem in details  And please don\u0026rsquo;t censor your IPs. It makes it harder for me to help, I wont attack you.\n Thank you for reading, have a great day!\n Discord: discord.darrennathanael.com Socials: link.darrennathanael.com  ","date":"2022-02-18T00:00:00Z","image":"https://darrennathanael.com/post/tunnelbroker-lavalink-ifup-ifdown/goodcontent_hu2c567c6c0fbd1d8910c54e59c05c7190_139514_120x120_fill_q75_h2_box_smart1_2.webp","permalink":"https://darrennathanael.com/post/tunnelbroker-lavalink-ifup-ifdown/","title":"setting up tunnelbroker (networks)"},{"content":"Hello üëã Hi, I\u0026rsquo;m Darren! I am a sysadmin. Meaning I have a lot of servers that I rent for testing and development. I also have a discord music bot Model Buses that uses lavalink.\nHaving one lavalink server isn\u0026rsquo;t enough\u0026hellip;. jk it\u0026rsquo;s prob enough, but I like to have a few more for redundancy.\nAs of writing this, my bot model buses are on 97 guilds, which isn\u0026rsquo;t that much. So having multiple lavalink servers is kind of overkill. But hey! That\u0026rsquo;s me! I like overkill stuff. And overcomplicating things.\nHost : losingtime.dpaste.org Port : 2124 Password : \u0026#34;SleepingOnTrains\u0026#34; Why Well, the reason I created this is that prominent lavalink hosting such as lava.link which is owned by something.host is great, But it\u0026rsquo;s dropping WS connection after a while due to it using Cloudflare. And it also disallowed playback from HTTP, Bandcamp and SoundCloud AFAIK, which is sad because I use those services. So I created this. Lavalink hosting that doesn\u0026rsquo;t use Cloudflare and doesn\u0026rsquo;t drop WS connections every few hours has all the features such as filters and all sources enabled.\nThis cost a lot of money to run, so if you are using it and would like to support me, you can donate via https://ko-fi.com/darrenofficial or by joining my Discord server.\nHow I designed/created my lavalink Measuring the cost of running a lavalink server Currently, I pay around $380/year with all the nodes combined, around 30 dollars per month.\nCurrently, I have three nodes running; those are equipped with 16 GB ram and a six-core processor. And I have one HAProxy instance running on my webserver.\nHow do I load balance it? HAProxy. Those HAProxy uses lessconn to load-balance the traffic. I have an HAProxy instance running on my OVH instance.\nYouTube Rate limiting YouTube has a rate limit. I have 2 X /48 IPv6 on each node to encounter it, which is around two million IPs per node.\n IPv6 Routes Table \nThe challenge of running lavalink Discord voice channels/gateway are fragile Discord has global networks all around the world to serve as voice servers. All audio is delivered over a UDP socket to the voice server. Discord was not designed for playing music, so it\u0026rsquo;s prone to drop audio frames. Due to the nature of UDP, a packet can be lost/dropped or for a packet to be duplicated. These packets are not resent if it\u0026rsquo;s dropped. This problem also appears on the receiver\u0026rsquo;s side, as they also use a UDP connection to the voice server.\nAs of me writing this, my lavalink is connected to 859 voice channels, and there are over 107 actively playing music. Each of the nodes handles around 300 bots/connections.\nSometimes my lavalink has small dropped frames; these dropped frames are called \u0026ldquo;stuttering\u0026rdquo;, or sometimes, it just outright disconnects the bot, making it unusable.  \n \nAnother cause for stuttering is when the voice server itself is misbehaving, where users are forced to manually change their voice region (and thus voice server). Most users \u0026amp; devs don\u0026rsquo;t realise this and blame the lavalink server/music bot for not working correctly.\nUpdating and maintaining Lavalink is a wrapper for lavaplayer, a java library that handles audio playback. This means that occasionally I have to restart the server for updates. I solved this issue by using \u0026ldquo;soft maintenance\u0026rdquo;, a feature on HAProxy that allows me to softly shut down the server, meaning no disconnect happens on the client-side.\nSupport me Running this is expensive, so I\u0026rsquo;m open to any donations.\nDiscord: DarrenOfficial#3451\nDiscord Server: https://discord.darrennathanael.com/\nKo-fi: https://ko-fi.com/darrenofficial\n","date":"2022-02-12T00:00:00Z","image":"https://darrennathanael.com/post/challenge-of-running-public-lavalink/lava_hu10b7e39112eaebd938322a05707ef1ee_127954_120x120_fill_q75_h2_box_smart1_2.webp","permalink":"https://darrennathanael.com/post/challenge-of-running-public-lavalink/","title":"The challenge of running lavalink"},{"content":"1. How it start  this is not the full start, I joined \u0026amp; help at jan 19, 2022. (Fun fact thats the same date as birthday lol)\n So this is how it went. on January jays webserver went down for almost a week. the reason? e-z.host.\n SKRRRTT#9999 the owner of ez.host \nyada yada yada, Jay\u0026rsquo;s vps dying moment.\n vps die moment \n2. Investigate Problem So first thing I do was check Cloudflare logs, see what traffic is going trough and see if Cloudflare was blocking it. Turns out 99% of the traffic is going pass Cloudflare and straight into the Server, no shit it was dying.\n Traffic Cloudflare \n3. Patch the issue \u0026amp; tesing The first thing I did was disable ICMP Ping on the server, this is to prevent the server from getting ping of death. and it works! for the server\u0026hellip; traffic still going trough Cloudflare, and the server is still accepting it.\nNext What I did was enable firewall on the server, I dont know why tf is it disabled in the first place. I enabled it and configured it to only allow incoming traffic from Cloudflare, My IP, Troplo IP(the other admin).\nAfter that I check the traffic on Cloudflare again, and sure it was, it\u0026rsquo;s still going trough the server. So I created a firewall rule @ Cloudflare to ban IP address that is requesting alot of stuff in a short time. that works. but it backfired. Regular user are getting banned as well.\nSo I reverted that change, and quickly unbanned all IP that the firewall rules banned. I got another stupid idea again, to add NGINX global ratelimit. well that kinda works but still\u0026hellip; normal users get ratelimited just by visiting the site.\nAfter that I contacted troplo to setup heavy ratelimit on the express server instead. it works but the traffic still going trough Cloudflare, and made the express server died. thus the ratelimiting is useless af.\nSo I check Cloudflare once more, and see what endpoint is being attacked. Turns out it was the /api/user end point and /api/domain endpoint. it was being spammed with request.\nSo I quickly created a WAF rule to block sus traffic going trough every endpoint, and it worked.\nAfter that I started monitoring the traffic again, the Server is not dying anymore and Cloudflare finnaly stopped sending the attacker traffic to the server.\n4. It works!  Traffic Block \n Discord: discord.darrennathanael.com Socials: link.darrennathanael.com  ","date":"2022-02-06T00:00:00Z","image":"https://darrennathanael.com/post/jayshost/520_hu3075ef4bf00bdc3fd48a6fe16a41e890_2210307_120x120_fill_box_smart1_3.png","permalink":"https://darrennathanael.com/post/jayshost/","title":"How I handle jays.host ddos attack"},{"content":"Why lavalink is usually used for discord bot to play music to discord.\nIf your bot is on alot of servers and alot of people, you need tunnelbroker to prevent youtube from rate limiting your ip.\n First and formost, we need to install lavalink. if you dont know how to you can check out the lavalink setup guide\nGetting TunnelBroker  Make a tunnelbroker Account Create a new regular tunnel Enter your IPv4 address and select a nearby region.  You can use https://github.com/DarrenOfficial/scripts-util/blob/main/general/he_ping.sh to find nearest / lowest ping tunnelbroker server.\n  Request a new /48 by clicking the \u0026ldquo;Assign /48\u0026rdquo; button. We can use /64, but is much more likely to be blocked.  Configuring TunnelBroker The first thing to do is enable IPv6 Binding in Linux. This enables Lavalink (and other programs) to bind to local addresses that would otherwise be considered illegal:\n# Enable now sysctl -w net.ipv6.ip_nonlocal_bind=1 # Persist for next boot echo \u0026#39;net.ipv6.ip_nonlocal_bind = 1\u0026#39; \u0026gt;\u0026gt; /etc/sysctl.conf Next you\u0026rsquo;ll need to configure netplan. create a file on /etc/netplan/ named anything ending in .yaml and add the following:\nnetwork: version: 2 tunnels: he-ipv6: mode: sit remote: local: addresses: - \u0026#34;\u0026#34; gateway6: \u0026#34;\u0026#34; You will now need to add your IPv6 subnet details, you\u0026rsquo;ll need to go to tunnelbroker and copy the Server IPv4 address, Client IPv4 address, and Routed IPv6 address.\nThen you can add the following to your /etc/netplan/ file, these should be arrange as shown in the template above.\n Your remote will be your \u0026lsquo;Server IPv4 address\u0026rsquo; Your local will be your \u0026lsquo;Client IPv4 address\u0026rsquo; Your gateway6 will be your \u0026lsquo;Routed IPv6 address\u0026rsquo; Your addresses will be your \u0026lsquo;Routed IPv6 address\u0026rsquo; Remember, you do not need to include any speech marks or apostrophes, we have simply listed them to clearly display what should only be listed. Please look at the sample configuration below, this should look similar but not the same as  network: version: 2 tunnels: he-ipv6: mode: sit remote: 216.66.84.42 local: 54.39.86.164 addresses: - \u0026#34;2001:470:cc7b::2/48\u0026#34; gateway6: \u0026#34;2001:470:cc7b::1\u0026#34; after doing all of that you can run netplan apply to apply the changes.\nTest your configuration Before setting up the lavalink, we need to test it to make sure it actually works.\n# Test that IPv6 works in the first place ping6 google.com # Test your tunnel with ping6 -I he-ipv6 google.com # If you have the IPv6 block 1234:1234:1234::/48 # You should be able to use any of the IPs within that block ping6 -I 1234:1234:1234:: google.com ping6 -I 1234:1234:1234::1 google.com ping6 -I 1234:1234:1234:dead::beef google.com # Make sure your /48 block appears when running this command ip -6 route ## it should look something like this #::1 dev lo proto kernel metric 256 pref medium #2001:470:cc7b::/48 dev he-ipv6 proto kernel metric 256 pref medium #fdba:17c8:6c94::/64 dev pterodactyl0 proto kernel metric 256 pref medium #fe80::/64 dev eth0 proto kernel metric 256 pref medium #fe80::/64 dev pterodactyl0 proto kernel metric 256 pref medium #fe80::/64 dev vethff50ad0 proto kernel metric 256 pref medium #fe80::/64 dev veth5832748 proto kernel metric 256 pref medium #default via 2001:470:cc7b::1 dev he-ipv6 proto static metric 1024 pref medium How to configure lavalink for loadbalancing Add the ratelimit block to your config:\nlavalink: server: # ... ratelimit: ipBlocks: [\u0026#34;1234:1234:1234::/48\u0026#34;] strategy: \u0026#34;LoadBalance\u0026#34; searchTriggersFail: true You can read more about the different strategies in ROUTEPLANNERS.md\n‚ÄúHelp, I\u0026rsquo;ve tried the steps above but It doesn\u0026rsquo;t work.‚Äù If you\u0026rsquo;ve followed this entire guide and It doesn\u0026rsquo;t work, then please contact me on my discord server discord.darrennathanael.com and I\u0026rsquo;ll help you out. and also provide the following information:\n Which distro you are on The network config you wrote based on one of the Tunnelbroker examples A screenshot of the Tunnelbroker website with your tunnel details Your Netplan config The output of ip -6 route Don\u0026rsquo;t say ‚Äúdoesn\u0026rsquo;t work‚Äù. Describe your problem in details  And please don\u0026rsquo;t censor your IPs. It makes it harder for me to help, I wont attack you.\n Inspired by Freya Arbjerg https://blog.arbjerg.dev/2020/3/tunnelbroker-with-lavalink\nThank you for reading, have a great day!\n Discord: discord.darrennathanael.com Socials: link.darrennathanael.com  ","date":"2022-02-05T00:00:00Z","image":"https://darrennathanael.com/post/tunnelbroker-lavalink-netplan/netplan_hu50b62e8641c0c972a483f6f518fccdc9_81832_120x120_fill_q75_h2_box_smart1_2.webp","permalink":"https://darrennathanael.com/post/tunnelbroker-lavalink-netplan/","title":"setting up tunnelbroker (netplan)"},{"content":" Disclaimer: Don‚Äôt use it to host video, theres nothing preventing you from doing so other than Cloudflare tos (2.8) but it‚Äôs better if you just use it for image storage.\n Hello there üëã Today we will use Cloudflare \u0026amp; GitLab to make the best ‚Äúfree‚Äù \u0026amp; fast CDN!\nHow do we do this you may ask, well simple. GitLab provides us with 10 GB repository limit, we can use this to host our original data via GitLab Pages, then we serve it via Cloudflare, and we set a page rule for our CDN, so it always hit the cached version!\nWhat is a CDN According to Cloudflare, a CDN is a  CDN \n A content delivery network (CDN) refers to a geographically distributed group of servers which work together to provide fast delivery of Internet content.\n  A CDN allows for the quick transfer of assets needed for loading Internet content including HTML pages, javascript files, stylesheets, images, and videos. The popularity of CDN services continues to grow, and today the majority of web traffic is served through CDNs, including traffic from major sites like Facebook, Netflix, and Amazon.\n  A properly configured CDN may also help protect websites against some common malicious attacks, such as Distributed Denial of Service (DDOS) attacks.\n Setup Requirements.  Domain. (you can use a subdomain that is on Cloudflare.) GitLab account.   Setting up GitLab environment Create your GitLab account if you don\u0026rsquo;t have one, go make it right now. Then create a repository with any name and the file .gitlab-ci.yml and a folder named public\nThen fill the .gitlab-ci.yml with\nimage: alpine:latest pages: stage: deploy script: - echo \u0026#39;Nothing to do...\u0026#39; artifacts: paths: - public expire_in: 1h20min rules: - if: $CI_COMMIT_REF_NAME == $CI_DEFAULT_BRANCH And your content on the public folder. Either image HTML file, anything.\nServe the content via GitLab Pages After you\u0026rsquo;ve done the steps above, GitLab should auto generate a website.\nConfiguring Cloudflare The next steps will be pretty straight forward. On GitLab, go to settings ‚Üí pages; then click on new domain. Add your domain there, and add it to Cloudflare by following the instructions. Next for optimization and 99% cache hit, set this page rule for your CDN domain\n Nice \nAfter that you\u0026rsquo;re good to go!\nThank you for reading, have a great day!\n Discord: discord.darrennathanael.com Socials: link.darrennathanael.com  ","date":"2021-12-14T00:00:00Z","image":"https://darrennathanael.com/post/how-to-make-your-own-cdn-with-10-gb-storage-for-free/cf_hu9222b8df8cca5e2954a2764b58459535_7708_120x120_fill_q75_h2_box_smart1_2.webp","permalink":"https://darrennathanael.com/post/how-to-make-your-own-cdn-with-10-gb-storage-for-free/","title":"How to make your own CDN with 10 GB storage for free"},{"content":"What are we doing today In this tutorial we will be setting up lavalink server! üéâ\n Let\u0026rsquo;s get started.\nNow, first thing first\nSetting up the enviroment To make a lavalink server, you will need a java 13 or greater, I recommend using Azul Zulu java 16 or 17.\nYou can download \u0026amp; setup java by going to here:\n Linux (Make sure to get zulu16-jdk or zulu17-jdk  Ubuntu / Debian; APT Base Rhel / CentOS / Oracle; RPM Base Arch; I use arch btw.   MacOS Windows  If you want to host lavalink on replit. you can just click this button  Run on Repl.it \nOnce install you can verify it by doing java -version, the output should look something like this\nopenjdk version \u0026#34;16.0.2\u0026#34; 2021-07-20 OpenJDK Runtime Environment Zulu16.32+15-CA (build 16.0.2+7) OpenJDK 64-Bit Server VM Zulu16.32+15-CA (build 16.0.2+7, mixed mode, sharing) depending on your os, you may need to restart to for it to apply.\nCongratulations ü•≥ you‚Äôve got Java installed!\n Setting up lavalink.jar To get started, you need to download the lavalink.jar and application.yml It‚Äôs pretty simple!\nThere are 2 jars provided below, one is the original one from freyacodes and one custom one made by melike2d which has alot more features than the original one\nLavalink Jar download   Original Jar\n https://github.com/freyacodes/Lavalink/releases/tag/3.4\n   Dev Jar\n https://ci.fredboat.com/repository/download/Lavalink_Build/.lastSuccessful/Lavalink.jar?guest=1\u0026branch=refs/heads/dev\n   Custom Jar\n https://cdn.darrennathanael.com/jars/Lavalink.jar\n   application.yml download   Lavalink Jar application.yml\n  Custom Jar application.yml\n  Once you‚Äôve downloaded the jar and application.yml file, you can simply edit the application.yml port and password to your preferences.\nNow last step is to move both into a single folder, then open a terminal to that folder using cd\n How to use cd in windows\n  How to use cd in mac\n  If your on linux go figure out yourself nerd.\n Then run it by doing java -jar Lavalink.jar or if you wanna limit it to only using X amount of ram you can do java -XmxXG -jar Lavalink.jar I.e. java -Xmx2G -jar Lavalink.jar\nand you should get an output similar to this:\n[root@darren-aws-testsrv lavalink]# java -Xmx2G -jar Lavalink.jar 2021-12-03 04:22:25.402 INFO 1826146 --- [ main] lavalink.server.Launcher : . _ _ _ _ __ _ _ /\\\\ | | __ ___ ____ _| (_)_ __ | | __\\ \\ \\ \\  ( ( )| |/ _` \\ \\ / / _` | | | \u0026#39;_ \\| |/ / \\ \\ \\ \\ \\\\/ | | (_| |\\ V / (_| | | | | | | \u0026lt; ) ) ) ) \u0026#39; |_|\\__,_| \\_/ \\__,_|_|_|_| |_|_|\\_\\ / / / / =========================================/_/_/_/ Version: 3.3.2.3 Build: 1239 Build time: 31.08.2021 17:26:20 UTC Branch main Commit: 2ad6b46 Commit time: 31.08.2021 17:17:13 UTC JVM: 17.0.1 Lavaplayer 1.3.93-original  And that‚Äôs it! You‚Äôve installed lavalink! üéâü•≥ Thank you for reading, have a great day!\n Discord: discord.darrennathanael.com Socials: link.darrennathanael.com  ","date":"2021-12-03T00:00:00Z","image":"https://darrennathanael.com/post/how-to-lavalink/mountain_hu575b42a87c1f4d6522e232bff1a834ab_26438_120x120_fill_q75_h2_box_smart1_2.webp","permalink":"https://darrennathanael.com/post/how-to-lavalink/","title":"How to make lavalink server"}]